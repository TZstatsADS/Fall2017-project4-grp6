---
title: "Prediction & Evaluation for the Dataset 1"
author: "Saaya Yasuda"
output: html_notebook
---

```{r setup,include=FALSE}
knitr::opts_knit$set(root.dir = '~/Documents/GitHub/fall2017-project4-fall2017-proj4-grp6')
```

Note:
Note: When you pull the csv files in the output folder, please use "git lfs pull." 
The files bigger than 100mb are uploaded using [git large file storage](https://git-lfs.github.com/).

Load dataset
```{r}
#rm(list=ls())
test1 <- read.csv("./output/dataset1_test.csv",header=T)
rownames(test1) = test1[,1]
test1 = test1[,-1]

train1 <- read.csv("./output/dataset1_train.csv",header=T)
rownames(train1) = train1[,1]
train1 = train1[,-1]
```

Load source
```{r}
source('./lib/evaluation_ranked_scoring.r')
source('./lib/z_score.R')
```

Prediction

Load correlation matrices for prediction.

Similarity weight - Spearman & no variance & neighbor_similarity
```{r}
SIM_Spearman_mat <- read.csv("./output/spearman_train1.csv",header=T)
neighbor_SIM_Spearman_mat <- read.csv("./output/neighbor_thresh_spearman.csv",header=T)

rownames(SIM_Spearman_mat) = SIM_Spearman_mat[,1]
SIM_Spearman_mat = SIM_Spearman_mat[,-1]
rownames(neighbor_SIM_Spearman_mat) = neighbor_SIM_Spearman_mat[,1]
neighbor_SIM_Spearman_mat = neighbor_SIM_Spearman_mat[,-1]

PRED_SIM_Spearman = z_score(train1, w=SIM_Spearman_mat, neighbor_matrix= neighbor_SIM_Spearman_mat)

file_name="./output/PRED_SIM_Spearman.csv"
write.csv(PRED_SIM_Spearman,file=file_name)

SCORE_SIM_Spearman= randked_scoring(PRED_SIM_Spearman,test1)
SCORE_SIM_Spearman
```

Similarity weight - Spearman & variance weighting & neighbor_similarity
```{r}
SIM_Spearman_mat_vw <- read.csv("./output/spearman_vm_train1.csv",header=T)
neighbor_SIM_Spearman_mat_vw <- read.csv("./output/neighbor_thresh_spearman_wv.csv",header=T)

rownames(SIM_Spearman_mat_vw) = SIM_Spearman_mat_vw[,1]
SIM_Spearman_mat_vw = SIM_Spearman_mat_vw[,-1]
rownames(neighbor_SIM_Spearman_mat_vw) = neighbor_SIM_Spearman_mat_vw[,1]
neighbor_SIM_Spearman_mat_vw = neighbor_SIM_Spearman_mat_vw[,-1]

PRED_SIM_Spearman_vw = z_score(train1, w=SIM_Spearman_mat_vw, neighbor_matrix= neighbor_SIM_Spearman_mat_vw)

file_name="./output/PRED_SIM_Spearman_vw.csv"
write.csv(PRED_SIM_Spearman_vw,file=file_name)

SCORE_SIM_Spearman_vw= randked_scoring(PRED_SIM_Spearman_vw,test1)
SCORE_SIM_Spearman_vw

```















end
#########################################################

Similarity weight - Vector Similarity
```{r}
SIM_vec_similarity_mat <- read.csv("../output/vectorsimilarity_train1.csv",header=T)
neighbor_SIM_vec_similarity_mat <- read.csv("../output/neighbor_thresh_vecsim.csv",header=T)

rownames(SIM_vec_similarity_mat) = SIM_vec_similarity_mat[,1]
SIM_vec_similarity_mat = SIM_vec_similarity_mat[,-1]
rownames(neighbor_SIM_vec_similarity_mat) = neighbor_SIM_vec_similarity_mat[,1]
neighbor_SIM_vec_similarity_mat = neighbor_SIM_vec_similarity_mat[,-1]

PRED_SIM_vec_similarity = z_score(test1, w=SIM_vec_similarity_mat, neighbor_SIM_vec_similarity_mat)

file_name="./output/PRED_SIM_vec_similarity.csv"
write.csv(PRED_SIM_vec_similarity,file=file_name)
```

Similarity weight - Mean Square Difference
```{r}
SIM_mean_sq_diff_mat <- read.csv("../output/meansqdiff_train1.csv",header=T)
rownames(SIM_mean_sq_diff_mat) = SIM_mean_sq_diff_mat[,1]
SIM_mean_sq_diff_mat = SIM_mean_sq_diff_mat[,-1]

PRED_SIM_mean_sq_diff = prediction_threshold(test1, weight=SIM_mean_sq_diff_mat)

file_name="./output/PRED_SIM_mean_sq_diff.csv"
write.csv(PRED_SIM_mean_sq_diff,file=file_name)
```

Similarity weight - SimRank
```{r}
SIM_simrank_mat <- read.csv("../output/[FILE_NAME_FOR_SIMRANK_MATRIX].csv",header=T)
rownames(SIM_simrank_mat) = SIM_simrank_mat[,1]
SIM_simrank_mat = SIM_simrank_mat[,-1]

PRED_SIM_simrank = prediction_threshold(test1, weight=SIM_simrank_mat)

file_name="./output/PRED_SIM_simrank.csv"
write.csv(PRED_SIM_simrank,file=file_name)
```

Variance weighting - Spearman
```{r}
VAR_Spearman_mat <- read.csv("../output/spearman_vm_train1.csv",header=T)
rownames(VAR_Spearman_mat) = VAR_Spearman_mat[,1]
VAR_Spearman_mat = VAR_Spearman_mat[,-1]

PRED_VAR_Spearman = prediction_threshold(test1, weight=VAR_Spearman_mat)

file_name="./output/PRED_VAR_Spearman.csv"
write.csv(PRED_VAR_Spearman,file=file_name)
```

Variance weighting - Vector Similarity
```{r}
VAR_vec_similarity_mat <- read.csv("../output/vectorsimilarity_vm_train1.csv",header=T)
rownames(VAR_vec_similarity_mat) = VAR_vec_similarity_mat[,1]
VAR_vec_similarity_mat = VAR_vec_similarity_mat[,-1]

PRED_VAR_vec_similarity = prediction_threshold(test1, weight=VAR_vec_similarity_mat)

file_name="./output/PRED_VAR_vec_similarity.csv"
write.csv(PRED_VAR_vec_similarity,file=file_name)
```

Selecting Neighbors - Weight Threshold
```{r}
SN_weight_threshold_mat <- read.csv("../output/[FILE_NAME_FOR_SN_WT_MATRIX].csv",header=T)
rownames(SN_weight_threshold_mat) = SN_weight_threshold_mat[,1]
SN_weight_threshold_mat = SN_weight_threshold_mat[,-1]

PRED_SN_weight_threshold = prediction_bnn(test1, weight=SN_weight_threshold_mat)

file_name="./output/PRED_SN_weight_threshold.csv"
write.csv(PRED_SN_weight_threshold,file=file_name)
```

Selecting Neighbors - Best-n-estimator
```{r}
SN_best_n_estimator_mat <- read.csv("../output/[FILE_NAME_FOR_SN_BNE_MATRIX].csv",header=T)
rownames(SN_best_n_estimator_mat) = SN_best_n_estimator_mat[,1]
SN_best_n_estimator_mat = SN_best_n_estimator_mat[,-1]

PRED_SN_best_n_estimator = prediction_bnn(test1, weight=SN_best_n_estimator_mat)

file_name="./output/PRED_SN_best_n_estimator.csv"
write.csv(PRED_SN_best_n_estimator,file=file_name)
```

Selecting Neighbors - Combined
```{r}
SN_combined_mat <- read.csv("../output/[FILE_NAME_FOR_SN_COMBINED_MATRIX].csv",header=T)
rownames(SN_combined_mat) = SN_combined_mat[,1]
SN_combined_mat = SN_combined_mat[,-1]

PRED_SN_combined = prediction_bnn(test1, weight=SN_combined_mat)

file_name="./output/PRED_SN_combined.csv"
write.csv(PRED_SN_combined,file=file_name)
```


Evaluation

Pick the best score.

from Similarity Weight
```{r}
SCORE_SIM_Spearman= randked_scoring(PRED_SIM_Spearman,test1)
SCORE_SIM_vec_similarity= randked_scoring(PRED_SIM_vec_similarity,test1)
SCORE_SIM_mean_sq_diff= randked_scoring(PRED_SIM_mean_sq_diff,test1)
SCORE_SIM_simrank= randked_scoring(PRED_SIM_simrank,test1)

SW = c(SCORE_SIM_Spearman, 
       SCORE_SIM_vec_similarity, 
       SCORE_SIM_mean_sq_diff,
       SCORE_SIM_simrank)
names(SW) = c("SCORE_SIM_Spearman", 
       "SCORE_SIM_vec_similarity", 
       "SCORE_SIM_mean_sq_diff",
       "SCORE_SIM_simrank")
SW
which.max(SW)
```

from Variance Weighting
```{r}
SCORE_VAR_Spearman= randked_scoring(PRED_VAR_Spearman,test1)
SCORE_VAR_vec_similarity= randked_scoring(PRED_VAR_vec_similarity,test1)

VW = c(SCORE_VAR_Spearman,
       SCORE_VAR_vec_similarity)
names(VW) = c("SCORE_VAR_Spearman",
              "SCORE_VAR_vec_similarity")

VW
which.max(VW)
```

from Selecting Neighbors
```{r}
SCORE_SN_weight_threshold= randked_scoring(PRED_SN_weight_threshold,test1)
SCORE_SN_best_n_estimator= randked_scoring(PRED_SN_best_n_estimator,test1)
SCORE_SN_combined= randked_scoring(PRED_SN_combined)

SN = c(SCORE_SN_weight_threshold,
       SCORE_SN_best_n_estimator,
       SCORE_SN_combined)
names(SN) = c("SCORE_SN_weight_threshold",
              "SCORE_SN_best_n_estimator",
              "SCORE_SN_combined")

SN
which.max(SN)

```

